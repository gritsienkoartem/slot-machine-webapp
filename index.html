<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ó–º–µ–π–∫–∞ üêç</title>
  <style>
    body {
      margin: 0;
      background: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: white;
      font-family: sans-serif;
      height: 100vh;
      overflow: hidden;
    }

    h1 {
      margin: 10px;
    }

    canvas {
      background: #000;
      border: 4px solid #4caf50;
      box-shadow: 0 0 20px #4caf50;
    }

    .controls {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 10px;
    }

    .btn {
      width: 60px;
      height: 60px;
      background: #444;
      border: 2px solid #666;
      border-radius: 10px;
      font-size: 24px;
      color: white;
      cursor: pointer;
    }

    .btn:active {
      background: #666;
    }
  </style>
</head>
<body>
  <h1>–ó–º–µ–π–∫–∞ üêç</h1>
  <canvas id="game" width="400" height="400"></canvas>

  <div class="controls">
    <div></div>
    <button class="btn" onclick="changeDir('up')">‚¨ÜÔ∏è</button>
    <div></div>
    <button class="btn" onclick="changeDir('left')">‚¨ÖÔ∏è</button>
    <div></div>
    <button class="btn" onclick="changeDir('right')">‚û°Ô∏è</button>
    <div></div>
    <button class="btn" onclick="changeDir('down')">‚¨áÔ∏è</button>
    <div></div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const gridSize = 20;

    let snake = [{ x: 200, y: 200 }];
    let dx = gridSize;
    let dy = 0;
    let food = spawnFood();
    let score = 0;

    function spawnFood() {
      return {
        x: Math.floor(Math.random() * (canvas.width / gridSize)) * gridSize,
        y: Math.floor(Math.random() * (canvas.height / gridSize)) * gridSize,
      };
    }

    function drawGrid() {
      ctx.strokeStyle = "#333";
      for (let x = 0; x < canvas.width; x += gridSize) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y < canvas.height; y += gridSize) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
    }

    function drawRect(x, y, color, isHead = false) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.roundRect(x + 1, y + 1, gridSize - 2, gridSize - 2, isHead ? 5 : 2);
      ctx.fill();
    }

    CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
      this.beginPath();
      this.moveTo(x + r, y);
      this.arcTo(x + w, y, x + w, y + h, r);
      this.arcTo(x + w, y + h, x, y + h, r);
      this.arcTo(x, y + h, x, y, r);
      this.arcTo(x, y, x + w, y, r);
      this.closePath();
    };

    function gameLoop() {
      const head = { x: snake[0].x + dx, y: snake[0].y + dy };

      // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
      if (
        head.x < 0 || head.x >= canvas.width ||
        head.y < 0 || head.y >= canvas.height ||
        snake.some((part) => part.x === head.x && part.y === head.y)
      ) {
        alert("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –°—á—ë—Ç: " + score);
        document.location.reload();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        food = spawnFood();
        score++;
      } else {
        snake.pop();
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawGrid();
      drawRect(food.x, food.y, "#ff4081");

      // –≥–æ–ª–æ–≤–∞
      drawRect(snake[0].x, snake[0].y, "#00ff00", true);
      // —Ç–µ–ª–æ
      for (let i = 1; i < snake.length; i++) {
        drawRect(snake[i].x, snake[i].y, "#76ff03");
      }
    }

    function changeDir(direction) {
      if (direction === "up" && dy === 0) {
        dx = 0; dy = -gridSize;
      } else if (direction === "down" && dy === 0) {
        dx = 0; dy = gridSize;
      } else if (direction === "left" && dx === 0) {
        dx = -gridSize; dy = 0;
      } else if (direction === "right" && dx === 0) {
        dx = gridSize; dy = 0;
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp") changeDir("up");
      if (e.key === "ArrowDown") changeDir("down");
      if (e.key === "ArrowLeft") changeDir("left");
      if (e.key === "ArrowRight") changeDir("right");
    });

    setInterval(gameLoop, 120);
  </script>
</body>
</html>
